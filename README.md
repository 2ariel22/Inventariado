# Sistema de Inventariado - API REST

## üìã Descripci√≥n

Sistema de gesti√≥n de inventario desarrollado con Spring Boot que permite administrar productos, ventas, empleados, clientes, proveedores y contabilidad. Incluye autenticaci√≥n JWT, roles y permisos granulares.

## ‚ú® Mejoras Recientes (√öltima Actualizaci√≥n)

### üîß Correcciones Implementadas
- **‚úÖ Referencias Circulares Resueltas**: JSON limpio sin bucles infinitos usando anotaciones Jackson
- **‚úÖ LazyInitializationException Corregida**: Relaciones ManyToMany optimizadas con FetchType.EAGER
- **‚úÖ Inicializaci√≥n de Admin Mejorada**: Usuario admin se crea/actualiza autom√°ticamente al iniciar
- **‚úÖ Seguridad de Contrase√±as**: Contrase√±as ocultas en respuestas JSON
- **‚úÖ Validaci√≥n de Registro**: Validaciones mejoradas para registro de usuarios
- **‚úÖ CORS Configurado**: Soporte completo para peticiones cross-origin
- **‚úÖ Logging Mejorado**: Logs detallados para debugging y monitoreo
- **‚úÖ Actualizaci√≥n de Usuarios**: DTO espec√≠fico para evitar problemas de serializaci√≥n
- **‚úÖ Creaci√≥n de Productos**: Soporte completo para fechas Java 8 (LocalDate)
- **‚úÖ Creaci√≥n de Ventas**: DTO espec√≠fico con validaciones robustas
- **‚úÖ Creaci√≥n de Empleados**: Validaciones completas y verificaciones de unicidad
- **‚úÖ Creaci√≥n de Proveedores**: Validaciones mejoradas y manejo de errores
- **‚úÖ Creaci√≥n de Registros Contables**: Validaciones de campos obligatorios
- **‚úÖ Gesti√≥n de Inventario**: DTO espec√≠fico y endpoint de debugging

### üöÄ Caracter√≠sticas Estables
- **Autenticaci√≥n JWT**: Sistema de tokens seguro y confiable
- **Roles y Permisos**: 4 roles predefinidos con 30+ permisos granulares
- **API REST Completa**: Endpoints para todos los m√≥dulos del sistema
- **Base de Datos Autom√°tica**: Inicializaci√≥n autom√°tica con Flyway
- **Documentaci√≥n Swagger**: API documentada e interactiva
- **Validaciones Robustas**: Todos los endpoints con validaciones completas
- **Manejo de Errores**: C√≥digos de estado HTTP espec√≠ficos y logging detallado

## üöÄ Inicio R√°pido

### Prerrequisitos
- Java 17+
- Maven 3.6+
- MySQL 8.0+
- Insomnia (o cualquier cliente REST)

### Configuraci√≥n Inicial

1. **Clonar el repositorio**
```bash
git clone https://github.com/2ariel22/Inventariado.git
cd Inventariado
```

2. **Configurar base de datos**
```sql
CREATE DATABASE inventory;
```

3. **Configurar aplicaci√≥n**
Editar `src/main/resources/application.properties`:
```properties
spring.datasource.url=jdbc:mysql://localhost:3306/inventory
spring.datasource.username=tu_usuario
spring.datasource.password=tu_password
```

4. **Ejecutar la aplicaci√≥n**
```bash
mvn spring-boot:run
```

La aplicaci√≥n se inicializar√° autom√°ticamente con:
- ‚úÖ 30+ permisos del sistema
- ‚úÖ 4 roles (ADMIN, VENDEDOR, CONTADOR, GERENTE)
- ‚úÖ Usuario administrador: `admin` / `admin123`

## üë• Roles de Usuario Disponibles

| ID | Rol | Descripci√≥n | Permisos Principales |
|---|---|---|---|
| **1** | **ADMIN** | Administrador del sistema | Acceso completo a todas las funcionalidades |
| **2** | **VENDEDOR** | Vendedor | Productos, ventas, inventario, clientes |
| **3** | **CONTADOR** | Contador | Contabilidad, ventas, productos, clientes |
| **4** | **GERENTE** | Gerente | Reportes y gesti√≥n general (lectura/actualizaci√≥n) |

### üìù Notas sobre Roles:
- **ADMIN**: Control total del sistema, puede crear/eliminar usuarios y modificar roles
- **VENDEDOR**: Rol por defecto para nuevos usuarios (si no se especifica `rolIds`)
- **CONTADOR**: Acceso a m√≥dulos financieros y de contabilidad
- **GERENTE**: Acceso de supervisi√≥n, principalmente lectura y actualizaci√≥n de datos

## üß™ Gu√≠a de Pruebas con Insomnia

### Configuraci√≥n de Insomnia

1. **Crear nueva colecci√≥n** llamada "Inventariado API"
2. **Configurar variable de entorno**:
   - `token`: (se llenar√° autom√°ticamente despu√©s del login)

**üìã Nota:** 
- Todas las rutas est√°n listas para copiar y pegar directamente en Insomnia
- Reemplaza `{token}` con el token JWT obtenido del login
- Todas las URLs usan `localhost:8080` por defecto

### 1. üîê Autenticaci√≥n

#### 1.1 Login como Administrador
```http
POST http://localhost:8080/api/auth/login
Content-Type: application/json

{
  "user": "admin",
  "password": "admin123"
}
```

**Respuesta esperada:**
```json
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "usuario": {
    "id": 1,
    "user": "admin",
    "email": "admin@inventariado.com",
    "nombre": "Administrador",
    "apellido": "Sistema",
    "activo": true,
    "roles": ["ADMIN"]
  }
}
```

**‚ö†Ô∏è Importante:** Copia el token de la respuesta y gu√°rdalo en la variable `token`.

## üöÄ Gu√≠a R√°pida: Crear Usuarios y Asignar Roles

### Paso 1: Obtener Lista de Roles
```http
GET http://localhost:8080/api/roles
Authorization: Bearer {token}
```

### Paso 2: Crear Usuario con Rol
```http
POST http://localhost:8080/api/usuarios
Authorization: Bearer {token}
Content-Type: application/json

{
  "user": "nuevo_usuario",
  "password": "123456",
  "email": "usuario@empresa.com",
  "nombre": "Nombre",
  "apellido": "Apellido",
  "activo": true,
  "rolIds": [2]
}
```

### Paso 3: Verificar Usuario Creado
```http
GET http://localhost:8080/api/usuarios
Authorization: Bearer {token}
```

### Paso 4: Asignar Roles Adicionales (Opcional)
```http
PUT http://localhost:8080/api/usuarios/{id}/roles
Authorization: Bearer {token}
Content-Type: application/json

{
  "rolIds": [2, 3]
}
```

#### 1.2 Registrar Nuevo Usuario

**Ejemplo b√°sico (asigna autom√°ticamente rol VENDEDOR):**
```http
POST http://localhost:8080/api/auth/register
Content-Type: application/json

{
  "user": "vendedor1",
  "password": "123456",
  "email": "vendedor1@empresa.com",
  "nombre": "Juan",
  "apellido": "Vendedor"
}
```

**Ejemplo con rol espec√≠fico:**
```http
POST http://localhost:8080/api/auth/register
Content-Type: application/json

{
  "user": "contador1",
  "password": "123456",
  "email": "contador1@empresa.com",
  "nombre": "Mar√≠a",
  "apellido": "Contador",
  "rolIds": [3]
}
```

**Ejemplos por tipo de usuario:**

**üëë Administrador:**
```http
POST http://localhost:8080/api/auth/register
Content-Type: application/json

{
  "user": "admin2",
  "password": "admin123",
  "email": "admin2@empresa.com",
  "nombre": "Admin",
  "apellido": "Secundario",
  "rolIds": [1]
}
```

**üõí Vendedor:**
```http
POST http://localhost:8080/api/auth/register
Content-Type: application/json

{
  "user": "vendedor1",
  "password": "vendedor123",
  "email": "vendedor1@empresa.com",
  "nombre": "Carlos",
  "apellido": "Vendedor",
  "rolIds": [2]
}
```

**üí∞ Contador:**
```http
POST http://localhost:8080/api/auth/register
Content-Type: application/json

{
  "user": "contador1",
  "password": "contador123",
  "email": "contador1@empresa.com",
  "nombre": "Mar√≠a",
  "apellido": "Contador",
  "rolIds": [3]
}
```

**üëî Gerente:**
```http
POST http://localhost:8080/api/auth/register
Content-Type: application/json

{
  "user": "gerente1",
  "password": "gerente123",
  "email": "gerente1@empresa.com",
  "nombre": "Ana",
  "apellido": "Gerente",
  "rolIds": [4]
}
```

**üìã Campos disponibles:**
- `user` (requerido): Nombre de usuario √∫nico
- `password` (requerido): Contrase√±a del usuario
- `email` (requerido): Correo electr√≥nico √∫nico
- `nombre` (opcional): Nombre del usuario
- `apellido` (opcional): Apellido del usuario
- `rolIds` (opcional): Array de IDs de roles a asignar (ver tabla de roles arriba)

**üìù Respuestas del endpoint:**
- `201 Created`: Usuario creado exitosamente
- `400 Bad Request`: Datos inv√°lidos (campos requeridos vac√≠os)
- `409 Conflict`: Usuario o email ya existe
- `500 Internal Server Error`: Error del servidor

#### 1.3 Validar Token
```http
POST http://localhost:8080/api/auth/validate?token={token}
```

#### 1.4 Logout
```http
POST http://localhost:8080/api/auth/logout
Authorization: Bearer {token}
```

### 2. üë• Gesti√≥n de Usuarios

#### 2.1 Listar Todos los Usuarios
```http
GET http://localhost:8080/api/usuarios
Authorization: Bearer {token}
```

**Respuesta esperada:**
```json
[
  {
    "id": 1,
    "user": "admin",
    "email": "admin@inventariado.com",
    "nombre": "Administrador",
    "apellido": "Sistema",
    "activo": true,
    "roles": [
      {
        "id": 1,
        "nombre": "ADMIN",
        "descripcion": "Administrador del sistema con acceso completo",
        "permisos": [
          {
            "id": 1,
            "nombre": "PRODUCTOS_CREAR",
            "descripcion": "Crear productos",
            "recurso": "PRODUCTOS",
            "accion": "CREAR"
          },
          {
            "id": 2,
            "nombre": "PRODUCTOS_LEER",
            "descripcion": "Leer productos",
            "recurso": "PRODUCTOS",
            "accion": "LEER"
          }
        ]
      }
    ]
  }
]
```

**üìù Nota**: Las contrase√±as est√°n ocultas por seguridad y no aparecen en las respuestas JSON.

#### 2.2 Obtener Usuario por ID
```http
GET http://localhost:8080/api/usuarios/1
Authorization: Bearer {token}
```

#### 2.3 Crear Usuario con Roles
```http
POST http://localhost:8080/api/usuarios
Authorization: Bearer {token}
Content-Type: application/json

{
  "user": "contador1",
  "password": "123456",
  "email": "contador1@empresa.com",
  "nombre": "Mar√≠a",
  "apellido": "Contador",
  "activo": true,
  "rolIds": [3]
}
```

**üí° Nota:** Para crear usuarios, es recomendable usar el endpoint de registro (`/api/auth/register`) que es m√°s simple y no requiere autenticaci√≥n.

**üìã Campos disponibles:**
- `user` (requerido): Nombre de usuario √∫nico
- `password` (requerido): Contrase√±a del usuario
- `email` (requerido): Correo electr√≥nico √∫nico
- `nombre` (opcional): Nombre del usuario
- `apellido` (opcional): Apellido del usuario
- `activo` (opcional): Estado del usuario (default: true)
- `rolIds` (opcional): Array de IDs de roles a asignar

#### 2.4 Actualizar Usuario
```http
PUT http://localhost:8080/api/usuarios/2
Authorization: Bearer {token}
Content-Type: application/json

{
  "user": "contador1",
  "email": "maria.contador@empresa.com",
  "nombre": "Mar√≠a",
  "apellido": "Contador Actualizado",
  "activo": true
}
```

#### 2.5 Eliminar Usuario
```http
DELETE http://localhost:8080/api/usuarios/2
Authorization: Bearer {token}
```

#### 2.6 Asignar Roles a Usuario Existente
```http
PUT http://localhost:8080/api/usuarios/2/roles
Authorization: Bearer {token}
Content-Type: application/json

{
  "rolIds": [2, 3]
}
```

#### 2.7 Ejemplos de Creaci√≥n de Usuarios por Rol

**üë®‚Äçüíº Crear Vendedor:**
```http
POST http://localhost:8080/api/usuarios
Authorization: Bearer {token}
Content-Type: application/json

{
  "user": "vendedor1",
  "password": "123456",
  "email": "vendedor1@empresa.com",
  "nombre": "Juan",
  "apellido": "Vendedor",
  "activo": true,
  "rolIds": [2]
}
```

**üìä Crear Contador:**
```http
POST http://localhost:8080/api/usuarios
Authorization: Bearer {token}
Content-Type: application/json

{
  "user": "contador1",
  "password": "123456",
  "email": "contador1@empresa.com",
  "nombre": "Mar√≠a",
  "apellido": "Contador",
  "activo": true,
  "rolIds": [3]
}
```

**üëî Crear Gerente:**
```http
POST http://localhost:8080/api/usuarios
Authorization: Bearer {token}
Content-Type: application/json

{
  "user": "gerente1",
  "password": "123456",
  "email": "gerente1@empresa.com",
  "nombre": "Carlos",
  "apellido": "Gerente",
  "activo": true,
  "rolIds": [4]
}
```

**üîß Crear Usuario con M√∫ltiples Roles:**
```http
POST http://localhost:8080/api/usuarios
Authorization: Bearer {token}
Content-Type: application/json

{
  "user": "supervisor1",
  "password": "123456",
  "email": "supervisor1@empresa.com",
  "nombre": "Ana",
  "apellido": "Supervisor",
  "activo": true,
  "rolIds": [2, 4]
}
```

### 3. üè∑Ô∏è Gesti√≥n de Roles

#### 3.1 Listar Roles Disponibles
```http
GET http://localhost:8080/api/roles
Authorization: Bearer {token}
```

**Respuesta esperada:**
```json
[
  {
    "id": 1,
    "nombre": "ADMIN",
    "descripcion": "Administrador del sistema",
    "permisos": [
      {
        "id": 1,
        "nombre": "PRODUCTOS_CREAR",
        "descripcion": "Crear productos",
        "recurso": "PRODUCTOS",
        "accion": "CREAR"
      }
    ]
  },
  {
    "id": 2,
    "nombre": "VENDEDOR",
    "descripcion": "Vendedor",
    "permisos": [...]
  },
  {
    "id": 3,
    "nombre": "CONTADOR",
    "descripcion": "Contador",
    "permisos": [...]
  },
  {
    "id": 4,
    "nombre": "GERENTE",
    "descripcion": "Gerente",
    "permisos": [...]
  }
]
```

#### 3.2 Roles Predefinidos del Sistema

| ID | Rol | Descripci√≥n | Permisos Principales |
|----|-----|-------------|---------------------|
| 1 | **ADMIN** | Administrador del sistema | Todos los permisos del sistema |
| 2 | **VENDEDOR** | Vendedor | Productos, Ventas, Inventario, Clientes |
| 3 | **CONTADOR** | Contador | Contabilidad, Ventas, Productos, Clientes |
| 4 | **GERENTE** | Gerente | Lectura y actualizaci√≥n de todos los m√≥dulos |

#### 3.3 Crear Nuevo Rol
```http
POST http://localhost:8080/api/roles
Authorization: Bearer {token}
Content-Type: application/json

{
  "nombre": "SUPERVISOR",
  "descripcion": "Supervisor de tienda"
}
```

#### 3.4 Asignar Permisos a Rol
```http
PUT http://localhost:8080/api/roles/5/permisos
Authorization: Bearer {token}
Content-Type: application/json

{
  "permisosIds": [1, 2, 3, 4, 5, 6]
}
```

#### 3.5 Obtener Rol por ID
```http
GET http://localhost:8080/api/roles/1
Authorization: Bearer {token}
```

#### 3.6 Actualizar Rol
```http
PUT http://localhost:8080/api/roles/1
Authorization: Bearer {token}
Content-Type: application/json

{
  "nombre": "ADMIN",
  "descripcion": "Administrador del sistema actualizado"
}
```

#### 3.7 Eliminar Rol
```http
DELETE http://localhost:8080/api/roles/5
Authorization: Bearer {token}
```

### 4. üîê Gesti√≥n de Permisos

#### 4.1 Listar Permisos Disponibles
```http
GET http://localhost:8080/api/permisos
Authorization: Bearer {token}
```

**Respuesta esperada:**
```json
[
  {
    "id": 1,
    "nombre": "PRODUCTOS_CREAR",
    "descripcion": "Crear productos",
    "recurso": "PRODUCTOS",
    "accion": "CREAR"
  },
  {
    "id": 2,
    "nombre": "PRODUCTOS_LEER",
    "descripcion": "Leer productos",
    "recurso": "PRODUCTOS",
    "accion": "LEER"
  }
]
```

#### 4.2 Permisos del Sistema

El sistema incluye **30+ permisos** organizados por m√≥dulos:

| M√≥dulo | Permisos Disponibles |
|--------|---------------------|
| **PRODUCTOS** | CREAR, LEER, ACTUALIZAR, ELIMINAR |
| **VENTAS** | CREAR, LEER, ACTUALIZAR, ELIMINAR |
| **INVENTARIO** | CREAR, LEER, ACTUALIZAR, ELIMINAR |
| **USUARIOS** | CREAR, LEER, ACTUALIZAR, ELIMINAR |
| **ROLES** | CREAR, LEER, ACTUALIZAR, ELIMINAR |
| **PERMISOS** | CREAR, LEER, ACTUALIZAR, ELIMINAR |
| **CONTABILIDAD** | CREAR, LEER, ACTUALIZAR, ELIMINAR |
| **EMPLEADOS** | CREAR, LEER, ACTUALIZAR, ELIMINAR |
| **CLIENTES** | CREAR, LEER, ACTUALIZAR, ELIMINAR |
| **PROVEEDORES** | CREAR, LEER, ACTUALIZAR, ELIMINAR |
| **SISTEMA** | ADMINISTRAR |

#### 4.3 Crear Nuevo Permiso
```http
POST http://localhost:8080/api/permisos
Authorization: Bearer {token}
Content-Type: application/json

{
  "nombre": "REPORTES_GENERAR",
  "descripcion": "Generar reportes",
  "recurso": "REPORTES",
  "accion": "GENERAR"
}
```

**üìã Campos disponibles:**
- `nombre` (requerido): Nombre √∫nico del permiso
- `descripcion` (opcional): Descripci√≥n del permiso
- `recurso` (opcional): M√≥dulo al que pertenece
- `accion` (requerido): Acci√≥n permitida (CREAR, LEER, ACTUALIZAR, ELIMINAR, ADMINISTRAR)

#### 4.4 Obtener Permiso por ID
```http
GET http://localhost:8080/api/permisos/1
Authorization: Bearer {token}
```

#### 4.5 Actualizar Permiso
```http
PUT http://localhost:8080/api/permisos/1
Authorization: Bearer {token}
Content-Type: application/json

{
  "nombre": "PRODUCTOS_CREAR",
  "descripcion": "Crear productos actualizado",
  "recurso": "PRODUCTOS",
  "accion": "CREAR"
}
```

#### 4.6 Eliminar Permiso
```http
DELETE http://localhost:8080/api/permisos/1
Authorization: Bearer {token}
```

### 5. üì¶ Gesti√≥n de Productos

#### 5.1 Listar Productos
```http
GET http://localhost:8080/api/productos
Authorization: Bearer {token}
```

#### 5.2 Crear Producto
```http
POST http://localhost:8080/api/productos
Authorization: Bearer {token}
Content-Type: application/json

{
  "nombre": "Laptop Dell Inspiron",
  "fechaExpiracion": "2025-12-31",
  "fechaVencimiento": "2026-12-31",
  "categoria": "Tecnolog√≠a",
  "stock": 10,
  "precio": 1500000.00
}
```

#### 5.3 Actualizar Producto
```http
PUT http://localhost:8080/api/productos/1
Authorization: Bearer {token}
Content-Type: application/json

{
  "nombre": "Laptop Dell Inspiron 15",
  "fechaExpiracion": "2025-12-31",
  "fechaVencimiento": "2026-12-31",
  "categoria": "Tecnolog√≠a",
  "stock": 8,
  "precio": 1600000.00
}
```

### 6. üõí Gesti√≥n de Ventas

#### 6.1 Listar Ventas
```http
GET http://localhost:8080/api/ventas
Authorization: Bearer {token}
```

#### 6.2 Crear Venta
```http
POST http://localhost:8080/api/ventas
Authorization: Bearer {token}
Content-Type: application/json

{
  "clienteId": 1,
  "vendedorId": 1,
  "descripcion": "Venta de laptop Dell",
  "fecha": "2024-01-15",
  "valorVenta": 1600000.00,
  "productoIds": [1, 2],
  "estado": "PENDIENTE"
}
```

### 7. üë®‚Äçüíº Gesti√≥n de Empleados

#### 7.1 Listar Empleados
```http
GET http://localhost:8080/api/empleados
Authorization: Bearer {token}
```

#### 7.2 Crear Empleado
```http
POST http://localhost:8080/api/empleados
Authorization: Bearer {token}
Content-Type: application/json

{
  "nombre": "Carlos",
  "cedula": "12345678",
  "edad": 30,
  "telefono": "3001234567",
  "correo": "carlos@empresa.com",
  "antiguedad": "2020-01-15"
}
```

**üìã Campos obligatorios:**
- `nombre`: Nombre del empleado
- `cedula`: C√©dula √∫nica del empleado
- `edad`: Edad (debe ser positiva)
- `telefono`: Tel√©fono de contacto
- `correo`: Correo electr√≥nico √∫nico
- `antiguedad`: Fecha de ingreso (formato: YYYY-MM-DD)

### 8. üë• Gesti√≥n de Clientes

#### 8.1 Listar Clientes
```http
GET http://localhost:8080/api/clientes
Authorization: Bearer {token}
```

#### 8.2 Crear Cliente
```http
POST http://localhost:8080/api/clientes
Authorization: Bearer {token}
Content-Type: application/json

{
  "nombre": "Ana Garc√≠a",
  "cedula": "87654321",
  "telefono": "3007654321",
  "correo": "ana.garcia@email.com"
}
```

### 9. üè¢ Gesti√≥n de Proveedores

#### 9.1 Listar Proveedores
```http
GET http://localhost:8080/api/proveedores
Authorization: Bearer {token}
```

#### 9.2 Crear Proveedor
```http
POST http://localhost:8080/api/proveedores
Authorization: Bearer {token}
Content-Type: application/json

{
  "nombre": "Distribuidora ABC",
  "ubicacion": "Bogot√°, Colombia",
  "antiguedad": "2018-01-01",
  "ultimaEntrega": "2024-01-10",
  "nit": "900123456-1",
  "telefono": "6012345678",
  "correo": "contacto@distribuidoraabc.com"
}
```

**üìã Campos obligatorios:**
- `nombre`: Nombre del proveedor
- `ubicacion`: Ubicaci√≥n del proveedor
- `antiguedad`: Fecha de inicio de relaci√≥n (formato: YYYY-MM-DD)

**üìã Campos opcionales:**
- `ultimaEntrega`: Fecha de √∫ltima entrega
- `nit`: NIT del proveedor (debe ser √∫nico si se proporciona)
- `telefono`: Tel√©fono de contacto
- `correo`: Correo electr√≥nico (debe ser √∫nico si se proporciona)

### 10. üìä Gesti√≥n de Contabilidad

#### 10.1 Listar Registros Contables
```http
GET http://localhost:8080/api/contabilidad
Authorization: Bearer {token}
```

#### 10.2 Crear Registro Contable General
```http
POST http://localhost:8080/api/contabilidad
Authorization: Bearer {token}
Content-Type: application/json

{
  "tipoMovimiento": "GASTO",
  "fecha": "2024-01-15",
  "gastos": 500000.00,
  "ingresos": 0.00,
  "descripcion": "Compra de suministros de oficina"
}
```

#### 10.3 Crear Registro de Gasto
```http
POST http://localhost:8080/api/contabilidad/gasto
Authorization: Bearer {token}
Content-Type: application/json

{
  "fecha": "2024-01-15",
  "gastos": 250.50,
  "descripcion": "Pago de servicios p√∫blicos"
}
```

#### 10.4 Crear Registro de Ingreso
```http
POST http://localhost:8080/api/contabilidad/ingreso
Authorization: Bearer {token}
Content-Type: application/json

{
  "fecha": "2024-01-15",
  "ingresos": 500.00,
  "descripcion": "Venta de productos"
}
```

#### 10.5 Obtener Registros por Tipo de Movimiento
```http
GET http://localhost:8080/api/contabilidad/tipo/GASTO
Authorization: Bearer {token}
```

#### 10.6 Obtener Registros por Rango de Fechas
```http
GET http://localhost:8080/api/contabilidad/fechas?fechaInicio=2024-01-01&fechaFin=2024-01-31
Authorization: Bearer {token}
```

### 11. üì¶ Gesti√≥n de Inventario

#### 11.1 Listar Inventarios
```http
GET http://localhost:8080/api/inventario
Authorization: Bearer {token}
```

#### 11.2 Crear Inventario (Recomendado)
```http
POST http://localhost:8080/api/inventario
Authorization: Bearer {token}
Content-Type: application/json

{
  "responsableId": 1,
  "descripcion": "Inventario principal de la empresa",
  "productoIds": [1, 2, 3]
}
```

#### 11.3 Crear Inventario (Debug)
```http
POST http://localhost:8080/api/inventario/debug
Authorization: Bearer {token}
Content-Type: application/json

{
  "responsable": {
    "id": 1
  },
  "descripcion": "Inventario debug"
}
```

#### 11.4 Obtener Inventario por ID
```http
GET http://localhost:8080/api/inventario/1
Authorization: Bearer {token}
```

#### 11.5 Obtener Inventarios por Responsable
```http
GET http://localhost:8080/api/inventario/responsable/1
Authorization: Bearer {token}
```

#### 11.6 Agregar Producto al Inventario
```http
PATCH http://localhost:8080/api/inventario/1/agregar-producto?productoId=2
Authorization: Bearer {token}
```

#### 11.7 Remover Producto del Inventario
```http
PATCH http://localhost:8080/api/inventario/1/remover-producto?productoId=2
Authorization: Bearer {token}
```

#### 11.8 Actualizar Responsable del Inventario
```http
PATCH http://localhost:8080/api/inventario/1/responsable?responsableId=2
Authorization: Bearer {token}
```


## üìö Documentaci√≥n Swagger

Accede a la documentaci√≥n interactiva en:
```
http://localhost:8080/swagger-ui.html
```

## üì° Resumen de Endpoints Principales

### üîê Autenticaci√≥n (Sin token requerido)
| M√©todo | Endpoint | Descripci√≥n |
|--------|----------|-------------|
| `POST` | `/api/auth/login` | Iniciar sesi√≥n |
| `POST` | `/api/auth/register` | Registrar nuevo usuario |
| `POST` | `/api/auth/validate` | Validar token JWT |
| `POST` | `/api/auth/logout` | Cerrar sesi√≥n |

### üë• Usuarios (Requiere token)
| M√©todo | Endpoint | Descripci√≥n |
|--------|----------|-------------|
| `GET` | `/api/usuarios` | Listar todos los usuarios |
| `GET` | `/api/usuarios/{id}` | Obtener usuario por ID |
| `POST` | `/api/usuarios` | Crear usuario (admin) |
| `PUT` | `/api/usuarios/{id}` | Actualizar usuario |
| `DELETE` | `/api/usuarios/{id}` | Eliminar usuario |

### üè∑Ô∏è Roles (Requiere token)
| M√©todo | Endpoint | Descripci√≥n |
|--------|----------|-------------|
| `GET` | `/api/roles` | Listar roles disponibles |
| `GET` | `/api/roles/{id}` | Obtener rol por ID |
| `POST` | `/api/roles` | Crear nuevo rol |
| `PUT` | `/api/roles/{id}` | Actualizar rol |
| `DELETE` | `/api/roles/{id}` | Eliminar rol |

### üõçÔ∏è Productos (Requiere token)
| M√©todo | Endpoint | Descripci√≥n |
|--------|----------|-------------|
| `GET` | `/api/productos` | Listar productos |
| `GET` | `/api/productos/{id}` | Obtener producto por ID |
| `POST` | `/api/productos` | Crear producto |
| `PUT` | `/api/productos/{id}` | Actualizar producto |
| `DELETE` | `/api/productos/{id}` | Eliminar producto |

### üí∞ Ventas (Requiere token)
| M√©todo | Endpoint | Descripci√≥n |
|--------|----------|-------------|
| `GET` | `/api/ventas` | Listar ventas |
| `GET` | `/api/ventas/{id}` | Obtener venta por ID |
| `POST` | `/api/ventas` | Crear venta |
| `PUT` | `/api/ventas/{id}` | Actualizar venta |
| `DELETE` | `/api/ventas/{id}` | Eliminar venta |

### üì¶ Inventario (Requiere token)
| M√©todo | Endpoint | Descripci√≥n |
|--------|----------|-------------|
| `GET` | `/api/inventario` | Listar inventarios |
| `GET` | `/api/inventario/{id}` | Obtener inventario por ID |
| `POST` | `/api/inventario` | Crear inventario (DTO) |
| `POST` | `/api/inventario/debug` | Crear inventario (entidad) |
| `PATCH` | `/api/inventario/{id}/agregar-producto` | Agregar producto |
| `PATCH` | `/api/inventario/{id}/remover-producto` | Remover producto |

### üìä Contabilidad (Requiere token)
| M√©todo | Endpoint | Descripci√≥n |
|--------|----------|-------------|
| `GET` | `/api/contabilidad` | Listar registros contables |
| `POST` | `/api/contabilidad` | Crear registro contable |
| `POST` | `/api/contabilidad/gasto` | Crear gasto |
| `POST` | `/api/contabilidad/ingreso` | Crear ingreso |
| `GET` | `/api/contabilidad/tipo/{tipo}` | Obtener por tipo |
| `GET` | `/api/contabilidad/fechas` | Obtener por rango de fechas |

## üõ†Ô∏è Tecnolog√≠as Utilizadas

- **Spring Boot 3.5.5**
- **Spring Security** - Autenticaci√≥n y autorizaci√≥n
- **JWT** - Tokens de autenticaci√≥n
- **JPA/Hibernate** - ORM
- **MySQL** - Base de datos
- **Flyway** - Migraciones de BD
- **Maven** - Gesti√≥n de dependencias
- **Jackson** - Procesamiento JSON

## üóÑÔ∏è Estructura de Base de Datos

### üìä Relaciones Entre Tablas

El sistema utiliza una base de datos MySQL con **13 tablas principales** y **4 tablas de relaci√≥n** que forman un esquema completo de gesti√≥n empresarial.

#### üîê **Sistema de Autenticaci√≥n y Autorizaci√≥n**

| Tabla | Relaci√≥n | Tabla Relacionada | Tipo | Descripci√≥n |
|-------|----------|-------------------|------|-------------|
| `usuarios` | ‚Üî | `roles` | Many-to-Many | Un usuario puede tener m√∫ltiples roles |
| `roles` | ‚Üî | `permisos` | Many-to-Many | Un rol puede tener m√∫ltiples permisos |

**Tablas de Relaci√≥n:**
- `usuario_roles`: Conecta usuarios con sus roles asignados
- `rol_permisos`: Conecta roles con sus permisos espec√≠ficos

#### üë• **M√≥dulo de Personas**

| Tabla | Relaci√≥n | Tabla Relacionada | Tipo | Descripci√≥n |
|-------|----------|-------------------|------|-------------|
| `empleados` | ‚Üí | `inventario` | One-to-Many | Un empleado puede ser responsable de m√∫ltiples inventarios |
| `empleados` | ‚Üí | `ventas` | One-to-Many | Un empleado puede realizar m√∫ltiples ventas |
| `clientes` | ‚Üí | `ventas` | One-to-Many | Un cliente puede realizar m√∫ltiples compras |

#### üì¶ **M√≥dulo de Productos e Inventario**

| Tabla | Relaci√≥n | Tabla Relacionada | Tipo | Descripci√≥n |
|-------|----------|-------------------|------|-------------|
| `productos` | ‚Üî | `inventario` | Many-to-Many | Un producto puede estar en m√∫ltiples inventarios |
| `productos` | ‚Üî | `ventas` | Many-to-Many | Un producto puede ser vendido en m√∫ltiples ventas |
| `productos` | ‚Üí | `detalle_venta` | One-to-Many | Un producto puede tener m√∫ltiples detalles de venta |

**Tablas de Relaci√≥n:**
- `inventario_productos`: Conecta inventarios con productos
- `venta_productos`: Conecta ventas con productos

#### üí∞ **M√≥dulo de Ventas**

| Tabla | Relaci√≥n | Tabla Relacionada | Tipo | Descripci√≥n |
|-------|----------|-------------------|------|-------------|
| `ventas` | ‚Üí | `detalle_venta` | One-to-Many | Una venta puede tener m√∫ltiples detalles |
| `ventas` | ‚Üí | `clientes` | Many-to-One | Una venta pertenece a un cliente |
| `ventas` | ‚Üí | `empleados` | Many-to-One | Una venta es realizada por un empleado |

### üîó **Diagrama de Relaciones Principales**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   USUARIOS  ‚îÇ‚óÑ‚îÄ‚îÄ‚ñ∫‚îÇ    ROLES    ‚îÇ‚óÑ‚îÄ‚îÄ‚ñ∫‚îÇ  PERMISOS   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ                   ‚îÇ                   ‚îÇ
       ‚îÇ                   ‚îÇ                   ‚îÇ
       ‚ñº                   ‚ñº                   ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  EMPLEADOS  ‚îÇ    ‚îÇ  INVENTARIO ‚îÇ    ‚îÇ  PRODUCTOS  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ                   ‚îÇ                   ‚îÇ
       ‚îÇ                   ‚îÇ                   ‚îÇ
       ‚ñº                   ‚ñº                   ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   CLIENTES  ‚îÇ    ‚îÇ    VENTAS   ‚îÇ    ‚îÇDETALLE_VENTA‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ                   ‚îÇ                   ‚îÇ
       ‚îÇ                   ‚îÇ                   ‚îÇ
       ‚ñº                   ‚ñº                   ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ PROVEEDORES ‚îÇ    ‚îÇCONTABILIDAD ‚îÇ    ‚îÇ             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### üìã **Resumen de Relaciones por M√≥dulo**

#### **üîê Autenticaci√≥n (3 tablas + 2 relaciones)**
- **usuarios** ‚Üî **roles** (Many-to-Many)
- **roles** ‚Üî **permisos** (Many-to-Many)

#### **üë• Gesti√≥n de Personas (3 tablas)**
- **empleados** ‚Üí **inventario** (One-to-Many)
- **empleados** ‚Üí **ventas** (One-to-Many)
- **clientes** ‚Üí **ventas** (One-to-Many)

#### **üì¶ Productos e Inventario (3 tablas + 1 relaci√≥n)**
- **productos** ‚Üî **inventario** (Many-to-Many)
- **empleados** ‚Üí **inventario** (One-to-Many)

#### **üí∞ Ventas (3 tablas + 1 relaci√≥n)**
- **ventas** ‚Üí **detalle_venta** (One-to-Many)
- **productos** ‚Üî **ventas** (Many-to-Many)
- **productos** ‚Üí **detalle_venta** (One-to-Many)

#### **üìä Contabilidad (1 tabla)**
- **contabilidad** (tabla independiente)

### üéØ **Caracter√≠sticas de las Relaciones**

#### **Integridad Referencial**
- **Foreign Keys**: Todas las relaciones tienen claves for√°neas
- **CASCADE**: Eliminaci√≥n en cascada para relaciones dependientes
- **RESTRICT**: Prevenci√≥n de eliminaci√≥n si hay dependencias

#### **Optimizaciones**
- **√çndices**: En todas las claves for√°neas
- **√önicos**: En campos cr√≠ticos (user, email, cedula, nit)
- **Timestamps**: Auditor√≠a autom√°tica en todas las tablas

#### **Tipos de Relaci√≥n**
- **One-to-Many**: 8 relaciones principales
- **Many-to-Many**: 4 relaciones con tablas intermedias
- **One-to-One**: 0 relaciones (dise√±o normalizado)

### üìä **Estad√≠sticas de la Base de Datos**

| M√©trica | Cantidad |
|---------|----------|
| **Tablas Principales** | 13 |
| **Tablas de Relaci√≥n** | 4 |
| **Total de Tablas** | 17 |
| **Relaciones One-to-Many** | 8 |
| **Relaciones Many-to-Many** | 4 |
| **Campos Totales** | 80+ |
| **Foreign Keys** | 15+ |
| **√çndices √önicos** | 10+ |

### üöÄ **Beneficios del Dise√±o**

‚úÖ **Normalizaci√≥n**: Evita redundancia de datos
‚úÖ **Integridad**: Relaciones consistentes y v√°lidas
‚úÖ **Escalabilidad**: Preparado para crecimiento
‚úÖ **Mantenibilidad**: Estructura clara y organizada
‚úÖ **Performance**: √çndices optimizados para consultas
‚úÖ **Flexibilidad**: Relaciones que permiten m√∫ltiples escenarios


## üìù Notas Importantes

- **Usuario admin por defecto**: `admin` / `admin123`
- **Token JWT**: V√°lido por 24 horas
- **Base de datos**: Se inicializa autom√°ticamente
- **Puerto**: 8080 (configurable en `application.properties`)

## üéØ Estado Actual del Sistema

### ‚úÖ Funcionalidades Completamente Operativas
- **Autenticaci√≥n y Autorizaci√≥n**: Login, registro, validaci√≥n de tokens
- **Gesti√≥n de Usuarios**: CRUD completo con roles y permisos
- **Gesti√≥n de Roles**: Creaci√≥n, asignaci√≥n y modificaci√≥n de roles
- **Gesti√≥n de Permisos**: Sistema granular de permisos por m√≥dulo
- **API REST**: Todos los endpoints funcionando correctamente
- **Base de Datos**: Inicializaci√≥n autom√°tica y migraciones
- **Documentaci√≥n**: Swagger UI disponible y actualizada

### üîß Problemas Resueltos Recientemente
1. **Referencias Circulares**: JSON limpio sin bucles infinitos
2. **LazyInitializationException**: Relaciones optimizadas
3. **Inicializaci√≥n de Admin**: Usuario admin siempre disponible
4. **Seguridad**: Contrase√±as ocultas en respuestas
5. **CORS**: Soporte completo para aplicaciones frontend
6. **Validaciones**: Registro de usuarios mejorado
7. **Actualizaci√≥n de Usuarios**: DTO espec√≠fico para evitar problemas de serializaci√≥n
8. **Creaci√≥n de Productos**: Soporte completo para fechas Java 8 (LocalDate)
9. **Creaci√≥n de Ventas**: DTO espec√≠fico con validaciones robustas
10. **Creaci√≥n de Empleados**: Validaciones completas y verificaciones de unicidad
11. **Creaci√≥n de Proveedores**: Validaciones mejoradas y manejo de errores
12. **Creaci√≥n de Registros Contables**: Validaciones de campos obligatorios
13. **Gesti√≥n de Inventario**: DTO espec√≠fico y endpoint de debugging

### üöÄ Listo para Producci√≥n
El sistema est√° completamente funcional y listo para ser utilizado en un entorno de producci√≥n con las siguientes caracter√≠sticas:
- Seguridad robusta con JWT
- Manejo de errores mejorado
- Logging detallado para monitoreo
- API REST bien documentada
- Base de datos optimizada

## ü§ù Contribuci√≥n

1. Fork el proyecto
2. Crear rama para feature (`git checkout -b feature/nueva-funcionalidad`)
3. Commit cambios (`git commit -m 'Agregar nueva funcionalidad'`)
4. Push a la rama (`git push origin feature/nueva-funcionalidad`)
5. Crear Pull Request

## üìÑ Licencia

Este proyecto est√° bajo la Licencia MIT - ver el archivo [LICENSE](LICENSE) para detalles.

---

**¬°Disfruta probando la API! üöÄ**
